





<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
  <head>
    <title>
    Shale Remoting</title>
    <style type="text/css" media="all">
      @import url("./css/maven-base.css");
      @import url("./css/maven-theme.css");
      @import url("./css/site.css");
    </style>
    <link rel="stylesheet" href="./css/print.css" type="text/css" media="print" />
        <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" />
  </head>
  <body class="composite">
    <div id="banner">
                          <a href="http://www.apache.org" id="bannerLeft">
    
                                    <img src="http://www.apache.org/images/asf-logo.gif" alt="" />
    
            </a>
                          <a href="http://shale.apache.org" id="bannerRight">
    
                                            <img src="../images/shale-logo.jpg" alt="" />
    
            </a>
            <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="breadcrumbs">
      <div class="xleft">Last Published: Mon Jun 02 11:05:58 CDT 2008</div>
      <div class="xright">  </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="leftColumn"><div id="navcolumn">      <h5>Sub-Project Documentation</h5>
    <ul>
              
    <li class="none">
          <a href="../shale-application/index.html">Application Controller</a>
        </li>
              
    <li class="none">
          <a href="../shale-clay/index.html">Clay Plug-In</a>
        </li>
              
    <li class="none">
          <a href="../shale-core/index.html">Core Library</a>
        </li>
              
    <li class="none">
          <a href="../shale-dialog/index.html">Dialog Manager</a>
        </li>
              
    <li class="none">
          <a href="../shale-dialog-basic/index.html">Dialog Manager (Basic Implementation)</a>
        </li>
              
    <li class="none">
          <a href="../shale-dialog-scxml/index.html">Dialog Manager (SCXML Implementation)</a>
        </li>
              
    <li class="none">
          <a href="../shale-remoting/index.html">Remoting</a>
        </li>
              
    <li class="none">
          <a href="../shale-spring/index.html">Spring Integration</a>
        </li>
              
    <li class="none">
          <a href="../shale-test/index.html">Test Framework</a>
        </li>
              
    <li class="none">
          <a href="../shale-tiger/index.html">Tiger Extensions</a>
        </li>
              
    <li class="none">
          <a href="../shale-validator/index.html">Validator Support</a>
        </li>
              
    <li class="none">
          <a href="../shale-view/index.html">View Controller</a>
        </li>
          </ul>
      <h5>Sample Apps Documentation</h5>
    <ul>
              
    <li class="none">
          <a href="../shale-apps/shale-blank/index.html">Blank Starter</a>
        </li>
              
    <li class="none">
          <a href="../shale-apps/shale-clay-usecases/index.html">Clay Use Cases</a>
        </li>
              
    <li class="none">
          <a href="../shale-apps/shale-mailreader/index.html">Mail Reader</a>
        </li>
              
    <li class="none">
          <a href="../shale-apps/shale-sql-browser/index.html">SQL Browser</a>
        </li>
              
    <li class="none">
          <a href="../shale-apps/shale-usecases/index.html">Use Cases</a>
        </li>
          </ul>
      <h5>Quick Links</h5>
    <ul>
              
    <li class="none">
          <a href="http://java.sun.com/javaee/javaserverfaces/">JavaServer Faces</a>
        </li>
              
    <li class="none">
          <a href="http://myfaces.apache.org">MyFaces</a>
        </li>
              
    <li class="none">
          <a href="http://shale.apache.org">Shale</a>
        </li>
              
    <li class="none">
          <a href="http://shale.apache.org/sandbox">Shale Sandbox</a>
        </li>
              
    <li class="none">
          <a href="http://struts.apache.org">Struts</a>
        </li>
              
    <li class="none">
          <a href="http://struts.apache.org/1.x/struts-faces">Struts-Faces Integration Library</a>
        </li>
          </ul>
      <h5>Project Documentation</h5>
    <ul>
              
    <li class="none">
          <strong><a href="index.html">About Shale Remoting</a></strong>
        </li>
              
                
        <li class="collapsed">
          <a href="project-info.html">Project Info</a>
                
            
            
      
            
      
            
      
            
      
            
      
            
      
            
      
            
      
            
      
              
          <ul>
                  
    <li class="none">
          <strong><a href="index.html">About</a></strong>
        </li>
                  
    <li class="none">
          <a href="integration.html">Continuous Integration</a>
        </li>
                  
    <li class="none">
          <a href="dependencies.html">Dependencies</a>
        </li>
                  
    <li class="none">
          <a href="dependency-convergence.html">Dependency Convergence</a>
        </li>
                  
    <li class="none">
          <a href="issue-tracking.html">Issue Tracking</a>
        </li>
                  
    <li class="none">
          <a href="mail-lists.html">Mailing Lists</a>
        </li>
                  
    <li class="none">
          <a href="license.html">Project License</a>
        </li>
                  
    <li class="none">
          <a href="project-summary.html">Project Summary</a>
        </li>
                  
    <li class="none">
          <a href="team-list.html">Project Team</a>
        </li>
                  
    <li class="none">
          <a href="source-repository.html">Source Repository</a>
        </li>
              </ul>
        </li>
              
                
        <li class="collapsed">
          <a href="maven-reports.html">Project Reports</a>
                
      
            
      
            
      
            
      
            
      
            
      
            
      
            
      
            
      
              
        </li>
          </ul>
  <a href="http://maven.apache.org/" title="Built by Maven" id="poweredBy">
              <img alt="Built by Maven" src="./images/logos/maven-feather.png"></img>
            </a>
    </div></div>
    <div id="bodyColumn">
      <div id="contentBox">
        

  

  
    
    <div class="section"><h2>Shale Remoting</h2>
    <a name="remoting"></a>

      <a name="remoting-introduction"></a>
      <div class="section"><h3>Remoting Introduction</h3>

         <p>Shale lets you map server-side resources, such as JavaScript or
         managed bean methods, to URLs. Shale turns URLs into resources with
         <i>processors</i>, which apply a mapping to a URL and take appropriate
         action. Out of the box, Shale provides the following processors:</p>

          <ul>
              <li>
                  <i>Class Resource</i>
                  : access static resources from your classpath
              </li>
              <li>
                  <i>Web Resource</i>
                  : access static resources from your web app's document root
              </li>
              <li>
                  <i>Method Binding</i>
                  : execute a managed bean's methods on the server
              </li>
              <li>
                  <i>Chain</i>
                  : maps a URL to a Apache Commons Chain (chains are used internally by Shale)
              </li>
          </ul>

          Complete information on the functionality provided by Shale Remoting
          may be found in the
          <a href="apidocs/org/apache/shale/remoting/package-summary.html">
          Javadoc package summary</a> for this module.  In particular, you will
          want to review the mechanisms for conditionally enabling access to
          resource identifiers for each processor, and what the default
          persmissions are.

      </div>

      <a name="remoting-static"></a>
      <div class="section"><h3>Remotely Accessing Static Resources</h3>

          <p>Shale can map URLs to &quot;classpath&quot; resources (those found in
          <code>/WEB-INF/classes</code>, or in a JAR file found in
          <code>/WEB-INF/lib</code>.  This makes it very easy, for example,
          for a JSF component library to embed JavaScript and CSS stylesheet
          resources required by its components, within the same JAR file,
          without requiring the application developer to explicitly configure
          anything, or place component resources at any particular point in
          the web application's document hierarchy.  In addition, Shale can
          map directly to webapp resources (equivalent to the static resource
          serving capability of most servlet containers), if desired.</p>

      </div>


      <a name="remoting-methods"></a>
      <div class="section"><h3>Remotely Calling Managed Bean Methods</h3>

          <p>Shale maps URLs to managed bean methods in your appliation with the
          Method Binding processor. For example, Shale maps the URL
          <code>remote/userBean/validateUsername.jsf</code> to a call to
          <code>userBean.validateUsername()</code> as shown in the following
          figure (assuming the suffix <code>.jsf</code> is mapped to the JSF
          servlet). This simple mechanism, among other things, lets you easily
          implement Ajax (Asynchronous JavaScript and XMLHttpRequest)
          functionality. </p>

          <p><img src="images/remoting-001.jpg"></img></p>

      </div>

      <a name="remoting-example"></a>
      <div class="section"><h3>An Ajax Example</h3>

          <p>Here's a form that implements realtime validation:</p>

          <p><img src="images/remoting-002.jpg"></img></p>

          <p> When the user leaves the <code>username</code> textfield, Shale
          calls the backing bean's <code>validateUsername</code> method. This
          application only has one registered user, and his name is Joe, so if
          the user types anything other than Joe in the username field, we
          display an error message, like this: </p>

          <p><img src="images/remoting-003.jpg"></img></p>

          <p>To implement the Ajax call, we first hook up a client-side event
          handler to our <code>username</code> textfield:</p>

          <pre>
          ...
            &lt;h:panelGroup&gt;

              &lt;h:inputText onfocus=&quot;hideMessage();&quot;
                 <strong>onblur=&quot;validateUsername(this.value);&quot;/&gt;</strong>

              &lt;f:verbatim&gt;
                &lt;div id=&quot;message&quot; style=&quot;display: none;&quot;&gt;&lt;/div&gt;
              &lt;/f:verbatim&gt;

            &lt;/h:panelGroup&gt;
          ...
          </pre>

          <p>Notice the empty <code>DIV</code>. That's the DIV that we'll fill
          with an error message as appropriate. When the user enters the
          username field, we clear out the message DIV, like this:</p>

          <pre>
          function hideMessage() {
             $(&quot;message&quot;).style.display = &quot;none&quot;; // the $ is Prototype's shorthand for window.document.getElementById()
          }
          </pre>

          <p>Here's the JavaScript <code>validateUsername</code> function:</p>

          <pre>
          function <strong>validateUsername</strong>(username) {
             new Ajax.Request(
                &quot;<strong>dynamic/userBean/validateUsername.faces</strong>&quot;,
                {
                   method: &quot;post&quot;,
                   parameters: &quot;username=&quot; + username,
                   onComplete: showMessage
                }
             );
          }
          </pre>

          <p>The preceding code fragment uses the <a href="http://prototype.conio.net/">Prototype JavaScript Library</a> to
          make the Ajax call. You can use whatever framework you like, or you
          can code the Ajax call yourself. The point here is the URL, which
          Shale maps to <code>userBean.validateUsername()</code>. Remember, when
          you invoke the URL <code>dynamic/userBean/validateUsername.jsf</code>
          Shale thinks <i>invoke <code>userBean.validateUsername()</code></i>.
          Here's what that Java code looks like:</p>

          <pre>
          public void validateUsername() {
              FacesContext context = FacesContext.getCurrentInstance();
              String username = (String)context
                  .getExternalContext()
                  .getRequestParameterMap().get(&quot;username&quot;);

              if( ! &quot;Joe&quot;.equals(username))
                  writeResponse(context, &quot;Sorry, that's an unathorized username&quot;);
          }
          private void writeResponse(FacesContext context,
              ResponseWriter writer =
                  (new <strong>ResponseFactory</strong>()).getResponseWriter(context, &quot;text/plain&quot;);
              try {
                  writer.writeText(text, null);
              }
              catch (IOException e) {
                  e.printStackTrace();
              }
          }
          </pre>

          <p>We get the username field's value from the corresponding request
          parameter and validate that value. After Shale invokes the
          <code>validateUsername</code> method, it short-circuits the JSF
          lifecycle so that JSF does not render a response.</p>

          <p><i>Note:</i> The <code>ResponseFactory</code> class is part of the
          Shale remoting package. See the <a href="apidocs/index.html">javadocs</a>
          for more information.</p>

          <p>After the call to <code>userBean.validateUsername()</code> returns,
          Prototype calls our <i>onComplete</i> JavaScript function, which we
          specified as <code>showMessage</code>. Here's what that JavaScript
          function looks like:</p>

          <pre>
          function showMessage(xhr) {
             var msg = $(&quot;message&quot;);  
             msg.style.display = &quot;inline&quot;;
             msg.style.color = &quot;red&quot;;
             msg.innerHTML = xhr.responseText; // set the innerHTML of the message DIV
          }
          </pre>
      </div>
      
      <div class="section"><h3>Resources</h3>
        <ul>
          <li>Shale Remoting
          <a href="apidocs/org/apache/shale/remoting/package-summary.html">
          Javadoc package summary</a></li>
          <li><a href="http://wiki.apache.org/shale/ShaleRemoting">
          ShaleRemoting</a> Wiki page</li>
        </ul>
      </div>

    </div>

  


      </div>
    </div>
    <div class="clear">
      <hr/>
    </div>
    <div id="footer">
      <div class="xright">&#169;  
          2004-2008
    
          The Apache Software Foundation
      </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
  </body>
</html>
