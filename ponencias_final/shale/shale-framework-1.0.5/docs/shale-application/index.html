





<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
  <head>
    <title>
    Shale Application Controller</title>
    <style type="text/css" media="all">
      @import url("./css/maven-base.css");
      @import url("./css/maven-theme.css");
      @import url("./css/site.css");
    </style>
    <link rel="stylesheet" href="./css/print.css" type="text/css" media="print" />
        <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" />
  </head>
  <body class="composite">
    <div id="banner">
                          <a href="http://www.apache.org" id="bannerLeft">
    
                                    <img src="http://www.apache.org/images/asf-logo.gif" alt="" />
    
            </a>
                          <a href="http://shale.apache.org" id="bannerRight">
    
                                            <img src="../images/shale-logo.jpg" alt="" />
    
            </a>
            <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="breadcrumbs">
      <div class="xleft">Last Published: Mon Jun 02 10:59:28 CDT 2008</div>
      <div class="xright">  </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="leftColumn"><div id="navcolumn">      <h5>Sub-Project Documentation</h5>
    <ul>
              
    <li class="none">
          <a href="../shale-application/index.html">Application Controller</a>
        </li>
              
    <li class="none">
          <a href="../shale-clay/index.html">Clay Plug-In</a>
        </li>
              
    <li class="none">
          <a href="../shale-core/index.html">Core Library</a>
        </li>
              
    <li class="none">
          <a href="../shale-dialog/index.html">Dialog Manager</a>
        </li>
              
    <li class="none">
          <a href="../shale-dialog-basic/index.html">Dialog Manager (Basic Implementation)</a>
        </li>
              
    <li class="none">
          <a href="../shale-dialog-scxml/index.html">Dialog Manager (SCXML Implementation)</a>
        </li>
              
    <li class="none">
          <a href="../shale-remoting/index.html">Remoting</a>
        </li>
              
    <li class="none">
          <a href="../shale-spring/index.html">Spring Integration</a>
        </li>
              
    <li class="none">
          <a href="../shale-test/index.html">Test Framework</a>
        </li>
              
    <li class="none">
          <a href="../shale-tiger/index.html">Tiger Extensions</a>
        </li>
              
    <li class="none">
          <a href="../shale-validator/index.html">Validator Support</a>
        </li>
              
    <li class="none">
          <a href="../shale-view/index.html">View Controller</a>
        </li>
          </ul>
      <h5>Sample Apps Documentation</h5>
    <ul>
              
    <li class="none">
          <a href="../shale-apps/shale-blank/index.html">Blank Starter</a>
        </li>
              
    <li class="none">
          <a href="../shale-apps/shale-clay-usecases/index.html">Clay Use Cases</a>
        </li>
              
    <li class="none">
          <a href="../shale-apps/shale-mailreader/index.html">Mail Reader</a>
        </li>
              
    <li class="none">
          <a href="../shale-apps/shale-sql-browser/index.html">SQL Browser</a>
        </li>
              
    <li class="none">
          <a href="../shale-apps/shale-usecases/index.html">Use Cases</a>
        </li>
          </ul>
      <h5>Quick Links</h5>
    <ul>
              
    <li class="none">
          <a href="http://java.sun.com/javaee/javaserverfaces/">JavaServer Faces</a>
        </li>
              
    <li class="none">
          <a href="http://myfaces.apache.org">MyFaces</a>
        </li>
              
    <li class="none">
          <a href="http://shale.apache.org">Shale</a>
        </li>
              
    <li class="none">
          <a href="http://shale.apache.org/sandbox">Shale Sandbox</a>
        </li>
              
    <li class="none">
          <a href="http://struts.apache.org">Struts</a>
        </li>
              
    <li class="none">
          <a href="http://struts.apache.org/1.x/struts-faces">Struts-Faces Integration Library</a>
        </li>
          </ul>
      <h5>Project Documentation</h5>
    <ul>
              
    <li class="none">
          <strong><a href="index.html">About Shale Application Controller</a></strong>
        </li>
              
                
        <li class="collapsed">
          <a href="project-info.html">Project Info</a>
                
            
            
      
            
      
            
      
            
      
            
      
            
      
            
      
            
      
            
      
              
          <ul>
                  
    <li class="none">
          <strong><a href="index.html">About</a></strong>
        </li>
                  
    <li class="none">
          <a href="integration.html">Continuous Integration</a>
        </li>
                  
    <li class="none">
          <a href="dependencies.html">Dependencies</a>
        </li>
                  
    <li class="none">
          <a href="dependency-convergence.html">Dependency Convergence</a>
        </li>
                  
    <li class="none">
          <a href="issue-tracking.html">Issue Tracking</a>
        </li>
                  
    <li class="none">
          <a href="mail-lists.html">Mailing Lists</a>
        </li>
                  
    <li class="none">
          <a href="license.html">Project License</a>
        </li>
                  
    <li class="none">
          <a href="project-summary.html">Project Summary</a>
        </li>
                  
    <li class="none">
          <a href="team-list.html">Project Team</a>
        </li>
                  
    <li class="none">
          <a href="source-repository.html">Source Repository</a>
        </li>
              </ul>
        </li>
              
                
        <li class="collapsed">
          <a href="maven-reports.html">Project Reports</a>
                
      
            
      
            
      
            
      
            
      
            
      
            
      
            
      
              
        </li>
          </ul>
  <a href="http://maven.apache.org/" title="Built by Maven" id="poweredBy">
              <img alt="Built by Maven" src="./images/logos/maven-feather.png"></img>
            </a>
    </div></div>
    <div id="bodyColumn">
      <div id="contentBox">
        

  

  
    
    <div class="section"><h2>Shale Application Controller</h2>
    <a name="application"></a>

      <a name="application-introduction"></a>
      <div class="section"><h3>Introduction</h3>

        <p>Much has been made of the fact that JavaServer Faces promotes
        a <em>page oriented</em> architecture for applications, typically
        associating a request scoped &quot;backing bean&quot; with each page to contain
        event handlers and/or submitted values.  Indeed, Shale itself offers
        extended support for this paradigm by virtue of its
        <a href="../shale-view/index.html">View Controller</a> feature.
        This is in contrast to the <em>action oriented</em> architecture
        typically found in web application frameworks like
        <a href="http://struts.apache.org/">Struts 1.x</a>.</p>

        <p>A second aspect of action oriented frameworks, however, is also
        useful.  They typically implement an application level
        <em>controller</em> (in the sense of the Model/View/Controller
        design pattern) through which <strong>all</strong> HTTP requests to
        the application are funneled.  Various frameworks offer mechanisms
        to customize the lifecycle processing that is performed, for example:
        </p>
        <ul>
        <li>In Struts 1.1-1.2, you subclass <code>RequestProcessor</code>
            and override the processXxx() series of methods that perform the
            actual processing of the request.</li>
        <li>In Struts 1.3, you customize the Commons Chain command pipeline
            that implements the standard request processing lifecycle.</li>
        <li>In JavaServer Faces, you can insert <code>PhaseListener</code>
            instances that receive control before or after the standard
            phases of the request processing lifecycle, which can exert
            control over what happens next.</li>
        </ul>

        Shale, being based upon JavaServer Faces, supports the standard
        <code>PhaseListener</code> approach to customizing the request
        processing lifecycle.  However, it also supports <em>Application
        Controller</em> functionality that can customize processing before
        or after the standard JavaServer Faces lifecycle, as described below.
        

      </div>

      <a name="application-services"></a>
      <div class="section"><h3>Services Provided</h3>

        <p>The <em>Application Controller</em> feature of Shale
        provides application wide services as described below:</p>

        <h4>(A) Standard Per-Request Processing</h4>

        <p>As described in <a href="../using.html#using-configuring">Configuring
        Your Application For Shale</a>, you are requested to configure a
        <em>Servlet Filter</em>
        (<code>org.apache.shale.application.faces.ShaleApplicationFilter</code>) and
        map it to process incoming URLs (typically using the URL pattern
        <code>/*</code> to process all requests to this application).
        This filter receives control both <strong>before</strong> and
        <strong>after</strong> the standard JavaServer Faces request
        processing lifecycle (which is implemented as a servlet).</p>

        <p><code>ShaleApplicationFilter</code> imposes a standard request
        processing lifecycle using
        <a href="http://commons.apache.org/chain/">Commons Chain</a>
        technology, which provides both preprocessing and postprocessing
        hooks where the application developer can plug in additional
        behavior at these two points in time.  The following processing
        is performed for each request:</p>
        <ul>
        <li>Construct an instance of <code>ShaleWebContext</code> (which
            implements the Commons Chain <code>Context</code> interface)
            to represent the current request.  This instance will be passed
            in to any Commons Chain commands involved in processing
            the current request.</li>
        <li>Store the <code>ShaleWebContext</code> instance as a request
            scope attribute under the key identified by manifest constant
            <code>ShaleApplicationFilter.CONTEXT_ATTR</code> so that it
            is available to later processing stages.</li>
        <li>Check for a Commons Chain <code>Command</code> instance named
            <code>preprocess</code> in the <code>shale</code> catalog.  If
            such a command (or chain) exists:
            <ul>
            <li>Execute the command or chain, rethrowing any
                exception that might occur.</li>
            <li>If the executed command or chain returned <code>true</code>
                (indicating that processing for the entire request should
                be considered complete), remove the request scope attribute
                that was added and earlier, and exit.</li>
            </ul></li>
        <li>Call <code>doFilter()</code> on the <code>FilterChain</code>
            argument passed in, which will ultimately trigger the standard
            JavaServer Faces processing when the incoming URL is mapped to
            <code>FacesServlet</code>.</li>
        <li>Check for a Commons Chain <code>Command</code> instance named
            <code>postprocess</code> in the <code>shale</code> catalog.
            If such a command (or chain) exists, execute it.</li>
        <li>Clean up the request scope attribute stored earlier.</li>
        </ul>

        <h4>(B) Preprocess and Postprocess Basic Implementations</h4>

        In addition to the standard request processing lifecycle described
        in the previous section, Shale offers an abstract base class
        <a href="apidocs/org/apache/shale/application/AbstractRegExpFilter.html">
        org.apache.shale.application.AbstractReqExpFilter</a>
        suitable for developing <code>preprocess</code> commands that perform
        request filtering based on matching incoming request values to
        regular expressions.  See the Javadocs for this class for more
        information.

        <p>Three concrete implementations based on this abstract base class
        are also provided:</p>
        <ul>
        <li><a href="apidocs/org/apache/shale/application/ContextRelativePathFilter.html">
            ContextRelativePathFilter</a> - Filters requests by matching the
            context relative portion of the path (i.e. starting with the slash
            after the context path itself) against one or more regular
            expressions.</li>
        <li><a href="apidocs/org/apache/shale/application/RemoteAddrFilter.html">
            RemoteAddrFilter</a> - Filters requests by matching the IP address
            of the remote client against one or more regular expressions.</li>
        <li><a href="apidocs/org/apache/shale/application/RemoteHostFilter.html">
            RemoteHostFilter</a> - Filters requests by matching the hostname
            of the remote client against one or more regular expressions.</li>
        </ul>

      </div>

      <a name="application-using"></a>
      <div class="section"><h3>Using Application Controller</h3>

        The <em>Use Cases</em> example application incorporates the
        <code>ContextRelativePathFilter</code> described above, using it
        to disallow direct access to JSP pages by URLs manually typed in
        to the browser.  This is accomplished by the following configuration
        stored in the <code>WEB-INF/chain-config.xml</code> resource:

<div class="source"><pre>
  &lt;catalogs&gt;

    &lt;catalog name=&quot;shale&quot;&gt;

      ...

      &lt;command className=&quot;org.apache.shale.application.ContextRelativePathFilter&quot;
       includes=&quot;\S*\.xml,\S*\.faces,\S*\.html,\S*\.gif,\S*\.jpg,index\.jsp&quot;
       excludes=&quot;\S*\.jsp,\S*\.jspf&quot;/&gt;

      ...

    &lt;/catalog&gt;

  &lt;/catalogs&gt;
</pre></div>

<p>The <code>ContextRelativePathFilter</code> instance is configured to pass
through context relative paths that match one of the regular expressions in
the <code>includes</code> attribute, while disallowing access for context
relative paths that match one of the regular expressions in the
<code>excludes</code> list.  With these settings, direct access to any URL
ending in <code>.jsp</code> or <code>.jspf</code> (other than to a resource
named <code>index.jsp</code>) will be prevented.</p>

      </div>

    </div>

  


      </div>
    </div>
    <div class="clear">
      <hr/>
    </div>
    <div id="footer">
      <div class="xright">&#169;  
          2004-2008
    
          The Apache Software Foundation
      </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
  </body>
</html>
