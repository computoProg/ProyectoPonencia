<?xml version="1.0"?>
<document>
<!--
 Licensed to the Apache Software Foundation (ASF) under one or more
 contributor license agreements.  See the NOTICE file distributed with
 this work for additional information regarding copyright ownership.
 The ASF licenses this file to you under the Apache License, Version 2.0
 (the "License"); you may not use this file except in compliance with
 the License.  You may obtain a copy of the License at

     http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.
-->
  <properties>
    <title>Shale Commons Validator Integration</title>
  </properties>

  <body>
    
    <section name="Commons Validator Integration">
    <a name="validation"/>

      <a name="validation-introduction"/>
      <subsection name="Validation Introduction">

        <p>JavaServer Faces 1.x does not explicitly support client-side
		  validation and only provides a minimal set of server-side
		  validators. On the other hand, <a href="http://commons.apache.org/validator/">Apache Commons Validator</a>
		  supports both client- and server-side validators and comes
		  with the following useful validators:</p>

        <ul>
        <li>Credit Card</li>
        <li>Date</li>
        <li>Email</li>
		  <li>Generic</li>
		  <li>ISBN</li>
		  <li>URL</li>
        </ul>

        <p>All of the preceding validators can be executed either on
		  the client or the server, or both. Shale integrates JavaServer Faces
		  and the Commons Validator.</p> 

      </subsection>

      <a name="validation-services"/>
      <subsection name="Services Provided">

        <p>Shale provides three JSP tags that let you use the Commons Validator:
		  <a href="tagreference.html#commonsValidator"><code>val:commonsValidator</code></a>,
          <a href="tagreference.html#validatorVar"><code>val:validatorVar</code></a>,
          and <a href="tagreference.html#validatorScript"><code>val:validatorScript</code></a>. The
		  first two lets you attach a commons validator to a JSF input component and
		  the third generates JavaScript validation code for validating each JSF component
		  that has one or more Commons validators in a particular form. You can attach as 
		  many Commons validators to a single JSF input component as you wish.</p>

      </subsection>

      <a name="validation-using"/>
      <subsection name="Using Commons Validator Integration">

        <p>Here's what you need to do to use Shale validation:</p>
		  <ul>
			<li>
			    Add an <code>onsubmit</code> attribute to your <code>h:form</code> tag that calls
				 the JavaScript validation function generated by <code>val:validatorScript</code>.
			</li>
			<li>
			    Add Commons validators to JSF input components with <code>val:commonsValidator</code>
                and, optionally, <code>val:validatorVar</code>.
			</li>
			<li>
			    Add an <code>val:validatorScript</code> tag at the end of the <code>h:form</code> tag's body.
			</li>
		  </ul>

        <p>Here's an example:</p>
<source>
&lt;%@ taglib uri="http://shale.apache.org/core" prefix="val" %&gt;
...
&lt;h:form onsubmit="return validateForm(this);"&gt;

    &lt;h:inputText id="creditCardNumber" 
               size="16"
              value="#{userContext.creditCardNumber}"&gt;

        &lt;val:commonsValidator type="required"
                             arg="#{msgs.creditCardNumberPrompt}"
                          server="true"
                          client="true"/&gt;

        &lt;val:commonsValidator type="mask"
                             arg="#{msgs.creditCardNumberPrompt}"
                          server="true"
                          client="true"&gt;
            &lt;val:validatorVar name="mask" value="[4-6].*"/&gt;
        &lt;/val:commonsValidator&gt;

        &lt;val:commonsValidator type="creditCard" 
                             arg="#{msgs.creditCardNumberPrompt}" 
                          server="true"/&gt;
    &lt;/h:inputText&gt; 

    &lt;h:message for="creditCardNumber" styleClass="errors"/&gt; 

    &lt;val:validatorScript functionName="validateForm"/&gt;
&lt;/h:form&gt;
...
</source>
        <p>In the preceding example, we've attached three Commons validators to a single
		     JSF input component. To pass validation, the field must have a value that
			  starts with a number between 4 and 6 inclusive and that value must be a valid
			  credit card number as verified by the <a href="http://en.wikipedia.org/wiki/Luhn_algorithm">Luhn</a> algorithm. Two of the
			  validations are performed on both client and server and one is performed
			  on the server only.</p>
			  <p><strong>Note:</strong> <i>At the present time, you have the option to forego
			  server-side validation, which is considered very bad practice. Users can turn off
			  JavaScript, so you should always backup client-side validation with server-side
			  validation. In the future, Shale may enforce server-side validation if it's
			  not explicitly specified.</i></p>
      </subsection>

      <a name="validation-custom"/>
      <subsection name="Using Custom Validaton Rules">
      
      <p>Shale's Commons Validator integration also allows you to use custom 
      validation rules.</p>
      
      <p>In most cases, you will want to include the default rule set in
      addition to your custom rules. In web.xml, use the
      <code>org.apache.shale.validator.VALIDATOR_RULES</code> context
      initialization parameter to specify a comma delimited list of files.</p>
      
<source>
    &lt;!-- Shale Validator Configuration Resources -->
    &lt;context-param>
       &lt;param-name>org.apache.shale.validator.VALIDATOR_RULES&lt;/param-name>
       &lt;param-value>
           /org/apache/shale/validator/validator-rules.xml,
           /WEB-INF/custom-rules.xml
       &lt;/param-value>
    &lt;/context-param>
</source>

      <p>In this example, the default validator-rules.xml file will be loaded
      from the shale-core.jar archive, and the custom-rules.xml file will be
      loaded from WEB-INF.</p>
      
      <p>To replace one of the provided rules,
      place a modified copy of 
      <a href="http://svn.apache.org/repos/asf/shale/framework/branches/SHALE_1_0_X/shale-validator/src/main/resources/org/apache/shale/validator/validator-rules.xml">validator-rules.xml</a>
      in your webapp, and refer to it instead of the default file.</p>

      <p>To add messages for your own validation rules, or to
      customize the 
      <a href="http://svn.apache.org/repos/asf/shale/framework/branches/SHALE_1_0_X/shale-validator/src/main/resources/org/apache/shale/validator/messages.properties">provided messages,</a>
      configure a message bundle for your application in 
      /WEB-INF/faces-config.xml.</p>
      
      <p>More information on Shale's Commons Validator integration, including
      step-by-step examples, can be found on the 
      <a href="http://wiki.apache.org/shale/ShaleValidation">ShaleValidation</a>
      Wiki page.</p>
      
      </subsection>
      
   </section>


  </body>

</document>
